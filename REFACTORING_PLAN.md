# –ü–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ hse-birthdays

## üìÖ –î–∞—Ç–∞ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è: 29 —è–Ω–≤–∞—Ä—è 2026

---

## üîç –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

### –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–ù–µ—Ç Dependency Injection (Koin)** ‚Äî –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é, –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
2. **–ó–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ –∫—Ä–µ–¥–µ–Ω—à–∞–ª—ã –ë–î** ‚Äî –ø–∞—Ä–æ–ª—å –∏ URL –ë–î –Ω–∞—Ö–æ–¥—è—Ç—Å—è –ø—Ä—è–º–æ –≤ –∫–æ–¥–µ (`Database.kt`)
3. **–ì–ª–æ–±–∞–ª—å–Ω—ã–π –ª–æ–≥–≥–µ—Ä** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–¥–∏–Ω `logger` –Ω–∞ –≤–µ—Å—å –ø—Ä–æ–µ–∫—Ç, –≤–º–µ—Å—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ª–æ–≥–≥–µ—Ä–æ–≤ –ø–æ –º–æ–¥—É–ª—è–º
4. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞** ‚Äî –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î –≤ –¥–≤—É—Ö –º–æ–¥—É–ª—è—Ö (`users-database` –∏ `telegram-bot`)
5. **–û–≥—Ä–æ–º–Ω—ã–µ —Ñ–∞–π–ª—ã**:
    - `BirthdayScheduler.kt` ‚Äî 498 —Å—Ç—Ä–æ–∫
    - `handleSearch.kt` ‚Äî 656 —Å—Ç—Ä–æ–∫
    - `hse-scraping/Main.kt` ‚Äî 224 —Å—Ç—Ä–æ–∫–∏ —Å –≥–ª—É–±–æ–∫–æ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å—é
6. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞–∫–µ—Ç–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã** ‚Äî —Ñ–∞–π–ª—ã –≤ –∫–æ—Ä–Ω–µ–≤—ã—Ö –ø–∞–∫–µ—Ç–∞—Ö –±–µ–∑ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
7. **–°–º–µ—à–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏** ‚Äî –ª–æ–≥–∏–∫–∞ –ë–î, –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è –≤ –æ–¥–Ω–∏—Ö —Ñ–∞–π–ª–∞—Ö
8. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤** ‚Äî –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã `transaction {}` –≤–µ–∑–¥–µ –ø–æ –∫–æ–¥—É
9. **–ù–µ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –Ω–∞–¥ Telegram Bot API** ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ç–µ—Å–Ω–æ —Å–≤—è–∑–∞–Ω–∞ —Å telegram-bot –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π

---

## ‚úÖ –ü—Ä–∏–Ω—è—Ç—ã–µ —Ä–µ—à–µ–Ω–∏—è

| –í–æ–ø—Ä–æ—Å               | –†–µ—à–µ–Ω–∏–µ                                                                                     |
|----------------------|---------------------------------------------------------------------------------------------|
| –°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ | –¢–µ–∫—É—â–∏–π `Env.kt` —Å —É–ª—É—á—à–µ–Ω–∏—è–º–∏ (data class'—ã –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π)                              |
| –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º–æ–¥—É–ª–µ–π   | –¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (common, users-database, hse-scraping, telegram-bot) ‚Äî —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –≤–Ω—É—Ç—Ä–∏ |
| –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ         | –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —á–∞—Å—Ç–µ–π (–ø–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç, –ø–æ–∏—Å–∫, —Ä–∞—Å—á—ë—Ç –≤–æ–∑—Ä–∞—Å—Ç–∞)                       |
| –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–∞—Ç       | kotlinx.datetime –≤–º–µ—Å—Ç–æ java.time                                                           |

---

## üìê –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–∫–µ—Ç–æ–≤ (–ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞):

```
common/
  ‚îî‚îÄ‚îÄ src/main/kotlin/io/github/kroune/common/
      ‚îú‚îÄ‚îÄ config/
      ‚îÇ   ‚îú‚îÄ‚îÄ Config.kt          # –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏
      ‚îÇ   ‚îî‚îÄ‚îÄ Env.kt             # –ß—Ç–µ–Ω–∏–µ .env
      ‚îú‚îÄ‚îÄ logging/
      ‚îÇ   ‚îî‚îÄ‚îÄ Loggers.kt         # –§–∞–±—Ä–∏–∫–∞ –ª–æ–≥–≥–µ—Ä–æ–≤
      ‚îî‚îÄ‚îÄ util/
          ‚îî‚îÄ‚îÄ DateUtils.kt       # –†–∞–±–æ—Ç–∞ —Å –¥–∞—Ç–∞–º–∏ (kotlinx.datetime)

users-database/
  ‚îî‚îÄ‚îÄ src/main/kotlin/io/github/kroune/database/
      ‚îú‚îÄ‚îÄ config/
      ‚îÇ   ‚îî‚îÄ‚îÄ DatabaseConfig.kt
      ‚îú‚îÄ‚îÄ tables/
      ‚îÇ   ‚îú‚îÄ‚îÄ Users.kt
      ‚îÇ   ‚îú‚îÄ‚îÄ Educations.kt
      ‚îÇ   ‚îú‚îÄ‚îÄ StaffPositions.kt
      ‚îÇ   ‚îú‚îÄ‚îÄ StaffAddresses.kt
      ‚îÇ   ‚îú‚îÄ‚îÄ WebRequests.kt
      ‚îÇ   ‚îú‚îÄ‚îÄ MobileSearches.kt
      ‚îÇ   ‚îî‚îÄ‚îÄ ErrorLogs.kt
      ‚îú‚îÄ‚îÄ repository/
      ‚îÇ   ‚îú‚îÄ‚îÄ UserRepository.kt
      ‚îÇ   ‚îú‚îÄ‚îÄ EducationRepository.kt
      ‚îÇ   ‚îî‚îÄ‚îÄ ErrorLogRepository.kt
      ‚îî‚îÄ‚îÄ DatabaseModule.kt      # Koin –º–æ–¥—É–ª—å

hse-scraping/
  ‚îî‚îÄ‚îÄ src/main/kotlin/io/github/kroune/scraping/
      ‚îú‚îÄ‚îÄ api/
      ‚îÇ   ‚îú‚îÄ‚îÄ HseMobileApi.kt
      ‚îÇ   ‚îî‚îÄ‚îÄ HseWebApi.kt
      ‚îú‚îÄ‚îÄ model/
      ‚îÇ   ‚îú‚îÄ‚îÄ User.kt
      ‚îÇ   ‚îú‚îÄ‚îÄ Staff.kt
      ‚îÇ   ‚îú‚îÄ‚îÄ Education.kt
      ‚îÇ   ‚îî‚îÄ‚îÄ Token.kt
      ‚îú‚îÄ‚îÄ service/
      ‚îÇ   ‚îú‚îÄ‚îÄ ScrapingService.kt
      ‚îÇ   ‚îî‚îÄ‚îÄ UserProcessor.kt
      ‚îî‚îÄ‚îÄ ScrapingModule.kt      # Koin –º–æ–¥—É–ª—å

telegram-bot/
  ‚îî‚îÄ‚îÄ src/main/kotlin/io/github/kroune/bot/
      ‚îú‚îÄ‚îÄ config/
      ‚îÇ   ‚îî‚îÄ‚îÄ BotConfig.kt
      ‚îú‚îÄ‚îÄ table/
      ‚îÇ   ‚îú‚îÄ‚îÄ BirthdayChats.kt
      ‚îÇ   ‚îú‚îÄ‚îÄ BirthdayChatTargetGroups.kt
      ‚îÇ   ‚îú‚îÄ‚îÄ BirthdayChatAdditionalUsers.kt
      ‚îÇ   ‚îî‚îÄ‚îÄ BirthdayCheckLog.kt
      ‚îú‚îÄ‚îÄ repository/
      ‚îÇ   ‚îú‚îÄ‚îÄ ChatRepository.kt
      ‚îÇ   ‚îú‚îÄ‚îÄ TargetGroupRepository.kt
      ‚îÇ   ‚îî‚îÄ‚îÄ AdditionalUserRepository.kt
      ‚îú‚îÄ‚îÄ service/
      ‚îÇ   ‚îú‚îÄ‚îÄ BirthdayService.kt      # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –î–†
      ‚îÇ   ‚îú‚îÄ‚îÄ SearchService.kt        # –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
      ‚îÇ   ‚îî‚îÄ‚îÄ NotificationService.kt  # –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
      ‚îú‚îÄ‚îÄ scheduler/
      ‚îÇ   ‚îî‚îÄ‚îÄ BirthdayScheduler.kt
      ‚îú‚îÄ‚îÄ command/
      ‚îÇ   ‚îú‚îÄ‚îÄ StartCommand.kt
      ‚îÇ   ‚îú‚îÄ‚îÄ HelpCommand.kt
      ‚îÇ   ‚îú‚îÄ‚îÄ group/
      ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AddGroupCommand.kt
      ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ DeleteGroupCommand.kt
      ‚îÇ   ‚îú‚îÄ‚îÄ user/
      ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AddUserCommand.kt
      ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DeleteUserCommand.kt
      ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ListUsersCommand.kt
      ‚îÇ   ‚îî‚îÄ‚îÄ birthday/
      ‚îÇ       ‚îú‚îÄ‚îÄ UpcomingCommand.kt
      ‚îÇ       ‚îî‚îÄ‚îÄ CheckBirthdaysCommand.kt
      ‚îú‚îÄ‚îÄ chain/                 # Input chains
      ‚îÇ   ‚îú‚îÄ‚îÄ GroupRegistrationChain.kt
      ‚îÇ   ‚îú‚îÄ‚îÄ AddGroupChain.kt
      ‚îÇ   ‚îú‚îÄ‚îÄ DeleteGroupChain.kt
      ‚îÇ   ‚îú‚îÄ‚îÄ DeleteUserChain.kt
      ‚îÇ   ‚îî‚îÄ‚îÄ UserSearchChain.kt
      ‚îú‚îÄ‚îÄ guard/
      ‚îÇ   ‚îî‚îÄ‚îÄ BotStartedGuard.kt
      ‚îú‚îÄ‚îÄ model/
      ‚îÇ   ‚îú‚îÄ‚îÄ UserInfo.kt
      ‚îÇ   ‚îî‚îÄ‚îÄ UserWrapper.kt
      ‚îú‚îÄ‚îÄ cache/
      ‚îÇ   ‚îî‚îÄ‚îÄ TTLCache.kt
      ‚îî‚îÄ‚îÄ BotModule.kt           # Koin –º–æ–¥—É–ª—å
```

---

## üìù –≠—Ç–∞–ø—ã —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

### –≠—Ç–∞–ø 1: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤—ã—Å–æ–∫–∏–π)

**–¶–µ–ª—å:** –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –±–∞–∑—É –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

1. **–î–æ–±–∞–≤–∏—Ç—å Koin –¥–ª—è DI**
    - –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `io.insert-koin:koin-core` –≤ `build.gradle.kts`
    - –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª–∏ Koin –¥–ª—è –∫–∞–∂–¥–æ–≥–æ Gradle-–º–æ–¥—É–ª—è

2. **–í—ã–Ω–µ—Å—Ç–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ë–î –∏–∑ –∫–æ–¥–∞**
    - –°–æ–∑–¥–∞—Ç—å `DatabaseConfig` data class
    - –ß–∏—Ç–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏–∑ `Env`
    - –£–±—Ä–∞—Ç—å —Ö–∞—Ä–¥–∫–æ–¥ –ø–∞—Ä–æ–ª–µ–π

3. **–°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ª–æ–≥–≥–µ—Ä—ã**
    - –ó–∞–º–µ–Ω–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π `logger` –Ω–∞ –ª–æ–≥–≥–µ—Ä—ã –ø–æ –∫–ª–∞—Å—Å–∞–º
    - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `KotlinLogging.logger {}` –≤ –∫–∞–∂–¥–æ–º –∫–ª–∞—Å—Å–µ

4. **–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –ø–∞–∫–µ—Ç–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É**
    - –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Ñ–∞–π–ª—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–∞–∫–µ—Ç—ã
    - –î–æ–±–∞–≤–∏—Ç—å `package` declarations

5. **–ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ kotlinx.datetime**
    - –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `org.jetbrains.kotlinx:kotlinx-datetime`
    - –ó–∞–º–µ–Ω–∏—Ç—å `java.time.*` –Ω–∞ `kotlinx.datetime.*`
    - –û–±–Ω–æ–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞—Ç

---

### –≠—Ç–∞–ø 2: Database Layer

**–¶–µ–ª—å:** –ò–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –ë–î –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

1. **–†–∞–∑–¥–µ–ª–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã –ø–æ —Ñ–∞–π–ª–∞–º**
    - `Users.kt` ‚Äî —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    - `Educations.kt` ‚Äî —Ç–∞–±–ª–∏—Ü–∞ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
    - `StaffPositions.kt` ‚Äî —Ç–∞–±–ª–∏—Ü–∞ –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π
    - `StaffAddresses.kt` ‚Äî —Ç–∞–±–ª–∏—Ü–∞ –∞–¥—Ä–µ—Å–æ–≤
    - –ò —Ç.–¥.

2. **–°–æ–∑–¥–∞—Ç—å Repository –∫–ª–∞—Å—Å—ã**
   ```kotlin
   interface UserRepository {
       fun findById(id: Int): User?
       fun findByMoodleId(moodleId: Int): User?
       fun findByEmail(email: String): User?
       fun findByDescriptionLike(pattern: String): List<User>
       fun save(user: User): Int
       fun existsByMoodleId(moodleId: Int): Boolean
   }
   ```

3. **–í—ã–Ω–µ—Å—Ç–∏ –≤—Å–µ `transaction {}` –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏**
    - –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞ –Ω–µ –¥–æ–ª–∂–Ω—ã –∑–Ω–∞—Ç—å –æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö
    - –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É—é—Ç —Ä–∞–±–æ—Ç—É —Å Exposed

4. **–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –ë–î**
    - –û–¥–∏–Ω –º–µ—Ç–æ–¥ `initDatabase()` –≤–º–µ—Å—Ç–æ –¥–≤—É—Ö
    - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ DI

---

### –≠—Ç–∞–ø 3: Telegram Bot ‚Äî –†–∞–∑–±–∏–µ–Ω–∏–µ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤

**–¶–µ–ª—å:** –£–ª—É—á—à–∏—Ç—å —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å

#### 3.1 –†–∞–∑–±–∏—Ç—å `BirthdayScheduler.kt` (498 —Å—Ç—Ä–æ–∫)

**–ë—ã–ª–æ:** –û–¥–∏–Ω —Ñ–∞–π–ª —Å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º, –ª–æ–≥–∏–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –î–† –∏ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–°—Ç–∞–Ω–µ—Ç:**

| –§–∞–π–ª                     | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å                                | ~–°—Ç—Ä–æ–∫ |
|--------------------------|------------------------------------------------|--------|
| `BirthdayScheduler.kt`   | –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á (cron-like)                 | ~80    |
| `BirthdayService.kt`     | –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞: –ø–æ–∏—Å–∫ –∏–º–µ–Ω–∏–Ω–Ω–∏–∫–æ–≤, –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç | ~150   |
| `NotificationService.kt` | –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π              | ~100   |
| `BirthdayCheckLog.kt`    | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫                           | ~50    |

**–ö–ª—é—á–µ–≤—ã–µ –∫–ª–∞—Å—Å—ã:**

```kotlin
class BirthdayScheduler(
    private val birthdayService: BirthdayService,
    private val scope: CoroutineScope
) {
    fun start()
    fun stop()
}

class BirthdayService(
    private val chatRepository: ChatRepository,
    private val userRepository: UserRepository,
    private val notificationService: NotificationService
) {
    suspend fun checkAndNotifyBirthdays(specificChatId: Long? = null)
    fun findBirthdayUsers(chatId: Long, date: LocalDate): List<BirthdayPerson>
}

class NotificationService(
    private val bot: TelegramBot
) {
    suspend fun sendBirthdayNotification(chatId: Long, users: List<BirthdayPerson>)
    fun buildBirthdayMessage(users: List<BirthdayPerson>): String
}
```

#### 3.2 –†–∞–∑–±–∏—Ç—å `handleSearch.kt` (656 —Å—Ç—Ä–æ–∫)

**–ë—ã–ª–æ:** –û–¥–∏–Ω —Ñ–∞–π–ª —Å –∫–æ–º–∞–Ω–¥–æ–π, chain'–∞–º–∏, –ø–æ–∏—Å–∫–æ–º –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π

**–°—Ç–∞–Ω–µ—Ç:**

| –§–∞–π–ª                 | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å             | ~–°—Ç—Ä–æ–∫ |
|----------------------|-----------------------------|--------|
| `AddUserCommand.kt`  | –ö–æ–º–∞–Ω–¥–∞ `/adduser`          | ~30    |
| `UserSearchChain.kt` | Input chain –¥–ª—è –ø–æ–∏—Å–∫–∞      | ~200   |
| `SearchService.kt`   | –õ–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞ –≤ –ë–î          | ~100   |
| `SearchSession.kt`   | –ú–æ–¥–µ–ª–∏ —Å–µ—Å—Å–∏–∏ –ø–æ–∏—Å–∫–∞        | ~30    |
| `SearchCallbacks.kt` | –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ callback –∫–Ω–æ–ø–æ–∫ | ~150   |

**–ö–ª—é—á–µ–≤—ã–µ –∫–ª–∞—Å—Å—ã:**

```kotlin
class SearchService(
    private val userRepository: UserRepository
) {
    fun search(criteria: SearchCriteria): List<SearchResult>
    fun buildSearchQuery(criteria: SearchCriteria): Op<Boolean>
}

data class SearchCriteria(
    val firstName: String? = null,
    val lastName: String? = null,
    val patronymic: String? = null,
    val email: String? = null,
    val groupName: String? = null,
    val userType: String? = null
)
```

---

### –≠—Ç–∞–ø 4: HSE Scraping

**–¶–µ–ª—å:** –£–ª—É—á—à–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫

1. **–†–∞–∑–±–∏—Ç—å `Main.kt` –Ω–∞:**
    - `ScrapingService.kt` ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–∫—Ä–∞–ø–∏–Ω–≥–∞
    - `UserProcessor.kt` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

2. **–í—ã–Ω–µ—Å—Ç–∏ HttpClient –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é**
    - –°–æ–∑–¥–∞—Ç—å `HttpClientFactory`
    - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ retry –≤ –∫–æ–Ω—Ñ–∏–≥–µ

3. **–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫**
    - –°–æ–∑–¥–∞—Ç—å sealed class –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    - –î–æ–±–∞–≤–∏—Ç—å structured logging

**–ö–ª—é—á–µ–≤—ã–µ –∫–ª–∞—Å—Å—ã:**

```kotlin
class ScrapingService(
    private val hseMobile: HseMobileApi,
    private val hseWeb: HseWebApi,
    private val userProcessor: UserProcessor
) {
    suspend fun scrapeUsers(startId: Int, endId: Int, concurrency: Int)
}

class UserProcessor(
    private val userRepository: UserRepository,
    private val educationRepository: EducationRepository,
    private val errorLogRepository: ErrorLogRepository
) {
    suspend fun processUser(moodleId: Int, userDetail: UserDetail)
}
```

---

### –≠—Ç–∞–ø 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–¶–µ–ª—å:** –ü–æ–∫—Ä—ã—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—É—é –ª–æ–≥–∏–∫—É —Ç–µ—Å—Ç–∞–º–∏

1. **–Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –¥–ª—è:**
    - `DateUtils` ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç
    - `BirthdayService.checkBirthdayMatch()` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –¥–Ω—è —Ä–æ–∂–¥–µ–Ω–∏—è
    - `BirthdayService.calculateAge()` ‚Äî —Ä–∞—Å—á—ë—Ç –≤–æ–∑—Ä–∞—Å—Ç–∞
    - `SearchService.buildSearchQuery()` ‚Äî –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤

2. **–°–æ–∑–¥–∞—Ç—å test fixtures:**
    - –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    - Mock —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

---

### –≠—Ç–∞–ø 6: –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è

**–¶–µ–ª—å:** –ö–æ–¥ —Ä–µ–≤—å—é –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∏–ª—é**
    - –ó–∞–ø—É—Å—Ç–∏—Ç—å detekt
    - –ò—Å–ø—Ä–∞–≤–∏—Ç—å warnings

2. **–û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é**
    - README.md —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
    - KDoc –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö API

3. **–û—á–∏—Å—Ç–∫–∞**
    - –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–¥
    - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

```kotlin
// build.gradle.kts (root)
val koinVersion = "3.5.0"
val kotlinxDatetimeVersion = "0.5.0"

// common/build.gradle.kts
dependencies {
    api("io.insert-koin:koin-core:$koinVersion")
    api("org.jetbrains.kotlinx:kotlinx-datetime:$kotlinxDatetimeVersion")
}
```

### –ü—Ä–∏–º–µ—Ä Koin –º–æ–¥—É–ª—è

```kotlin
// DatabaseModule.kt
val databaseModule = module {
    single { DatabaseConfig.fromEnv() }
    single { initDatabase(get()) }
    single<UserRepository> { UserRepositoryImpl(get()) }
    single<EducationRepository> { EducationRepositoryImpl(get()) }
}

// BotModule.kt  
val botModule = module {
    single { BotConfig.fromEnv() }
    single { TelegramBot(get<BotConfig>().token) { ... } }
    single { ChatRepository() }
    single { BirthdayService(get(), get(), get()) }
    single { NotificationService(get()) }
    single { BirthdayScheduler(get(), get()) }
}
```

### –ü—Ä–∏–º–µ—Ä –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ kotlinx.datetime

```kotlin
// –î–æ (java.time)
import java.time.LocalDate
import java.time.format.DateTimeFormatter

fun parseBirthDate(birthDate: String): LocalDate? {
    return LocalDate.parse(birthDate, DateTimeFormatter.ofPattern("yyyy-MM-dd"))
}

// –ü–æ—Å–ª–µ (kotlinx.datetime)
import kotlinx . datetime . LocalDate

fun parseBirthDate(birthDate: String): LocalDate? {
    return runCatching { LocalDate.parse(birthDate) }.getOrNull()
}
```

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

| –ú–µ—Ç—Ä–∏–∫–∞                                      | –î–æ        | –ü–æ—Å–ª–µ       |
|----------------------------------------------|-----------|-------------|
| –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞                    | 656 —Å—Ç—Ä–æ–∫ | < 200 —Å—Ç—Ä–æ–∫ |
| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ `transaction {}` –≤–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ | ~30       | 0           |
| –•–∞—Ä–¥–∫–æ–¥ –∫—Ä–µ–¥–µ–Ω—à–∞–ª–æ–≤                          | 2 –º–µ—Å—Ç–∞   | 0           |
| –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ –∫—Ä–∏—Ç–∏—á–Ω–æ–π –ª–æ–≥–∏–∫–∏            | 0%        | > 80%       |

---

## üöÄ –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

1. ‚úÖ –≠—Ç–∞–ø 1: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
2. ‚¨ú –≠—Ç–∞–ø 2: Database Layer
3. ‚¨ú –≠—Ç–∞–ø 3: Telegram Bot
4. ‚¨ú –≠—Ç–∞–ø 4: HSE Scraping
5. ‚¨ú –≠—Ç–∞–ø 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
6. ‚¨ú –≠—Ç–∞–ø 6: –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è

---

## üìå –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –ö–∞–∂–¥—ã–π —ç—Ç–∞–ø –¥–æ–ª–∂–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞
- –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞ ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ö–æ–º–º–∏—Ç—ã –¥–µ–ª–∞—Ç—å –∞—Ç–æ–º–∞—Ä–Ω—ã–º–∏ (–æ–¥–∏–Ω —ç—Ç–∞–ø = –æ–¥–∏–Ω PR)
